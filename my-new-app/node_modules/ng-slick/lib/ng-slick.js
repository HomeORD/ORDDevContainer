'use strict';

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _angular = require('angular');

var _angular2 = _interopRequireDefault(_angular);

var _jquery = require('jquery');

var _jquery2 = _interopRequireDefault(_jquery);

require('slick-carousel');

require('slick-carousel/slick/slick.css');

require('./ng-slick.less');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

//require('slick-carousel/slick/slick-theme.css');

_angular2.default.module('ngSlick', []).directive('ngSlick', ['$timeout', function (timeout) {
  return {
    scope: {
      ngSlickOptions: '='
    },
    restrict: 'AE',
    link: function link(scope, element, attrs) {
      var lastslide = void 0;
      var parent = scope.$parent;

      var slider = (0, _jquery2.default)(element).addClass('ng-slick').css('opacity', 0).on('init', function (event, slick) {
        var slide = slick.$slides[slick.slickCurrentSlide()];
        if (slide && attrs.zooming === 'true') {
          (0, _jquery2.default)(slide).addClass('slick-slide-zooming');
        }

        if (attrs.ngSlickInit) parent.$eval(attrs.ngSlickInit, { $event: event, $slick: slick });
      }).on('beforeChange', function (event, slick, currentSlide, nextSlide) {
        lastslide = slick.$slides[currentSlide];

        var slide = slick.$slides[nextSlide];
        if (slide && attrs.zooming === 'true') {
          (0, _jquery2.default)(slide).addClass('slick-slide-zooming');
        }

        if (attrs.ngSlickBeforeChange) parent.$eval(attrs.ngSlickBeforeChange, { $event: event, $slick: slick, $currentSlide: currentSlide, $nextSlide: nextSlide });
      }).on('afterChange', function (event, slick, currentSlide) {
        if (lastslide) (0, _jquery2.default)(lastslide).removeClass('slick-slide-zooming');

        if (attrs.ngSlickAfterChange) parent.$eval(attrs.ngSlickAfterChange, { $event: event, $slick: slick, $currentSlide: currentSlide });
      }).on('breakpoint', function (event, slick, breakpoint) {
        if (attrs.ngSlickBreakpoint) parent.$eval(attrs.ngSlickBreakpoint, { $event: event, $slick: slick, $breakpoint: breakpoint });
      }).on('destroy', function (event, slick) {
        if (attrs.ngSlickDestroy) parent.$eval(attrs.ngSlickDestroy, { $event: event, $slick: slick });
      }).on('edge', function (event, slick, direction) {
        if (attrs.ngSlickEdge) parent.$eval(attrs.ngSlickEdge, { $event: event, $slick: slick, $direction: direction });
      }).on('reInit', function (event, slick) {
        if (attrs.ngSlickReInit) parent.$eval(attrs.ngSlickReInit, { $event: event, $slick: slick });
      }).on('setPosition', function (event, slick) {
        if (attrs.ngSlickSetPosition) parent.$eval(attrs.ngSlickSetPosition, { $event: event, $slick: slick });
      }).on('swipe', function (event, slick, direction) {
        if (attrs.ngSlickSwipe) parent.$eval(attrs.ngSlickSwipe, { $event: event, $slick: slick, $direction: direction });
      }).on('lazyLoaded', function (event, slick, image, imageSource) {
        if (attrs.ngSlickLazyLoaded) parent.$eval(attrs.ngSlickLazyLoaded, { $event: event, $slick: slick, $image: image, $src: imageSource, $imageSource: imageSource });
      }).on('lazyLoadError', function (event, slick, image, imageSource) {
        if (attrs.ngSlickLazyLoadError) parent.$eval(attrs.ngSlickLazyLoadError, { $event: event, $slick: slick, $image: image, $src: imageSource, $imageSource: imageSource });
      });

      var buildoptions = function buildoptions() {
        var o = scope.ngSlickOptions || {};

        if ('dots' in attrs) o.dots = attrs.dots !== 'false';
        if ('cssEase' in attrs) o.cssEase = attrs.cssEase;
        if ('fade' in attrs) o.fade = attrs.fade === 'true';
        if ('focusOnSelect' in attrs) o.focusOnSelect = attrs.focusOnSelect;
        if ('lazyLoad' in attrs) o.lazyLoad = attrs.lazyLoad === 'true';
        if ('draggable' in attrs) o.draggable = attrs.draggable !== 'false';
        if ('easing' in attrs) o.easing = attrs.easing;
        if ('centerMode' in attrs) o.centerMode = attrs.centerMode;
        if ('centerPadding' in attrs) o.centerPadding = attrs.centerPadding;
        if ('accessibility' in attrs) o.accessibility = attrs.accessibility !== 'false';
        if ('centerPadding' in attrs) o.centerPadding = attrs.centerPadding;
        if ('adaptiveHeight' in attrs) o.adaptiveHeight = attrs.adaptiveHeight !== 'false';
        if ('arrows' in attrs) o.arrows = attrs.arrows !== 'false';
        if ('pauseOnHover' in attrs) o.pauseOnHover = attrs.pauseOnHover !== 'false';
        if ('responsive' in attrs) o.responsive = attrs.responsive && parent.$eval(attrs.responsive);
        if ('rtl' in attrs) o.rtl = attrs.rtl === 'true';
        if ('touchMove' in attrs) o.touchMove = attrs.touchMove !== 'false';
        if ('touchThreshold' in attrs && +attrs.touchThreshold) o.touchThreshold = +attrs.touchThreshold;
        if ('useCSS' in attrs) o.useCSS = attrs.useCSS !== 'false';
        if ('variableWidth' in attrs) o.variableWidth = attrs.variableWidth !== 'false';
        if ('vertical' in attrs) o.vertical = attrs.vertical !== 'false';
        if ('infinite' in attrs) o.infinite = attrs.infinite !== 'false';
        if ('speed' in attrs && +attrs.speed) o.speed = +attrs.speed;
        if ('slidesToShow' in attrs && +attrs.slidesToShow) o.slidesToShow = +attrs.slidesToShow;
        if ('swipeToSlide' in attrs) o.swipeToSlide = attrs.swipeToSlide !== 'false';
        if ('autoplay' in attrs) o.autoplay = attrs.autoplay !== 'false';
        if ('autoplaySpeed' in attrs && +attrs.autoplaySpeed) o.autoplaySpeed = +attrs.autoplaySpeed;
        if ('zIndex' in attrs && +attrs.zIndex) o.zIndex = +attrs.zIndex;

        return o;
      };

      var init = function init() {
        if (!slider.hasClass('ng-slick-init')) {
          slider.addClass('ng-slick-init').css('opacity', 1).slick(buildoptions()).slick('setPosition').slick('slickGoTo', 0).slick('slickPlay');
        }
      };

      var destroy = function destroy() {
        if (slider.hasClass('ng-slick-init')) slider.removeClass('ng-slick-init').remove('slick-list').slick('unslick');
      };

      var refreshing = false;
      var refresh = function refresh() {
        if (refreshing) return;

        refreshing = true;
        destroy();
        setTimeout(function () {
          refreshing = false;
          init();
        }, 150);
      };

      scope.$on('$destroy', function () {
        return destroy();
      });

      attrs.ngWatch && parent.$watch(attrs.ngWatch, function () {
        return timeout(refresh);
      });

      scope.$watch('ngSlickOptions', function () {
        var o = scope.ngSlickOptions;
        if (o && (typeof o === 'undefined' ? 'undefined' : (0, _typeof3.default)(o)) === 'object') timeout(refresh);
      }, true);

      scope.refresh = element[0].refresh = function () {
        return timeout(refresh);
      };

      return !attrs.ngWatch && timeout(init, 10);
    }
  };
}]);

// ref: http://plnkr.co/edit/WCEWwgNcIEC0rseaZIO6?p=preview
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9uZy1zbGljay5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwidGltZW91dCIsInNjb3BlIiwibmdTbGlja09wdGlvbnMiLCJyZXN0cmljdCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cnMiLCJsYXN0c2xpZGUiLCJwYXJlbnQiLCIkcGFyZW50Iiwic2xpZGVyIiwiYWRkQ2xhc3MiLCJjc3MiLCJvbiIsImV2ZW50Iiwic2xpY2siLCJzbGlkZSIsIiRzbGlkZXMiLCJzbGlja0N1cnJlbnRTbGlkZSIsInpvb21pbmciLCJuZ1NsaWNrSW5pdCIsIiRldmFsIiwiJGV2ZW50IiwiJHNsaWNrIiwiY3VycmVudFNsaWRlIiwibmV4dFNsaWRlIiwibmdTbGlja0JlZm9yZUNoYW5nZSIsIiRjdXJyZW50U2xpZGUiLCIkbmV4dFNsaWRlIiwicmVtb3ZlQ2xhc3MiLCJuZ1NsaWNrQWZ0ZXJDaGFuZ2UiLCJicmVha3BvaW50IiwibmdTbGlja0JyZWFrcG9pbnQiLCIkYnJlYWtwb2ludCIsIm5nU2xpY2tEZXN0cm95IiwiZGlyZWN0aW9uIiwibmdTbGlja0VkZ2UiLCIkZGlyZWN0aW9uIiwibmdTbGlja1JlSW5pdCIsIm5nU2xpY2tTZXRQb3NpdGlvbiIsIm5nU2xpY2tTd2lwZSIsImltYWdlIiwiaW1hZ2VTb3VyY2UiLCJuZ1NsaWNrTGF6eUxvYWRlZCIsIiRpbWFnZSIsIiRzcmMiLCIkaW1hZ2VTb3VyY2UiLCJuZ1NsaWNrTGF6eUxvYWRFcnJvciIsImJ1aWxkb3B0aW9ucyIsIm8iLCJkb3RzIiwiY3NzRWFzZSIsImZhZGUiLCJmb2N1c09uU2VsZWN0IiwibGF6eUxvYWQiLCJkcmFnZ2FibGUiLCJlYXNpbmciLCJjZW50ZXJNb2RlIiwiY2VudGVyUGFkZGluZyIsImFjY2Vzc2liaWxpdHkiLCJhZGFwdGl2ZUhlaWdodCIsImFycm93cyIsInBhdXNlT25Ib3ZlciIsInJlc3BvbnNpdmUiLCJydGwiLCJ0b3VjaE1vdmUiLCJ0b3VjaFRocmVzaG9sZCIsInVzZUNTUyIsInZhcmlhYmxlV2lkdGgiLCJ2ZXJ0aWNhbCIsImluZmluaXRlIiwic3BlZWQiLCJzbGlkZXNUb1Nob3ciLCJzd2lwZVRvU2xpZGUiLCJhdXRvcGxheSIsImF1dG9wbGF5U3BlZWQiLCJ6SW5kZXgiLCJpbml0IiwiaGFzQ2xhc3MiLCJkZXN0cm95IiwicmVtb3ZlIiwicmVmcmVzaGluZyIsInJlZnJlc2giLCJzZXRUaW1lb3V0IiwiJG9uIiwibmdXYXRjaCIsIiR3YXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7O0FBRUFBLGtCQUFRQyxNQUFSLENBQWUsU0FBZixFQUEwQixFQUExQixFQUE4QkMsU0FBOUIsQ0FBd0MsU0FBeEMsRUFBbUQsQ0FBQyxVQUFELEVBQWEsVUFBU0MsT0FBVCxFQUFrQjtBQUNoRixTQUFPO0FBQ0xDLFdBQU87QUFDTEMsc0JBQWdCO0FBRFgsS0FERjtBQUlMQyxjQUFVLElBSkw7QUFLTEMsUUFMSyxnQkFLQUgsS0FMQSxFQUtPSSxPQUxQLEVBS2dCQyxLQUxoQixFQUt1QjtBQUMxQixVQUFJQyxrQkFBSjtBQUNBLFVBQU1DLFNBQVNQLE1BQU1RLE9BQXJCOztBQUVBLFVBQU1DLFNBQVMsc0JBQUVMLE9BQUYsRUFDWk0sUUFEWSxDQUNILFVBREcsRUFFWkMsR0FGWSxDQUVSLFNBRlEsRUFFRyxDQUZILEVBR1pDLEVBSFksQ0FHVCxNQUhTLEVBR0QsVUFBQ0MsS0FBRCxFQUFRQyxLQUFSLEVBQWtCO0FBQzVCLFlBQU1DLFFBQVFELE1BQU1FLE9BQU4sQ0FBY0YsTUFBTUcsaUJBQU4sRUFBZCxDQUFkO0FBQ0EsWUFBSUYsU0FBU1YsTUFBTWEsT0FBTixLQUFrQixNQUEvQixFQUF3QztBQUN0QyxnQ0FBRUgsS0FBRixFQUFTTCxRQUFULENBQWtCLHFCQUFsQjtBQUNEOztBQUVELFlBQUlMLE1BQU1jLFdBQVYsRUFDRVosT0FBT2EsS0FBUCxDQUFhZixNQUFNYyxXQUFuQixF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QUFVLFVBQVYsRUFBc0I7QUFBQSxlQUFNTCxTQUFOO0FBQUEsT0FBdEI7O0FBRUF6RSxZQUFNK0UsT0FBTixJQUFpQjdFLE9BQU84RSxNQUFQLENBQWNoRixNQUFNK0UsT0FBcEIsRUFBNkI7QUFBQSxlQUFNckYsUUFBUWtGLE9BQVIsQ0FBTjtBQUFBLE9BQTdCLENBQWpCOztBQUVBakYsWUFBTXFGLE1BQU4sQ0FBYSxnQkFBYixFQUErQixZQUFNO0FBQ25DLFlBQU1yQyxJQUFJaEQsTUFBTUMsY0FBaEI7QUFDQSxZQUFJK0MsS0FBSyxRQUFPQSxDQUFQLHVEQUFPQSxDQUFQLE9BQWEsUUFBdEIsRUFBaUNqRCxRQUFRa0YsT0FBUjtBQUNsQyxPQUhELEVBR0csSUFISDs7QUFLQWpGLFlBQU1pRixPQUFOLEdBQWdCN0UsUUFBUSxDQUFSLEVBQVc2RSxPQUFYLEdBQXFCO0FBQUEsZUFBTWxGLFFBQVFrRixPQUFSLENBQU47QUFBQSxPQUFyQzs7QUFFQSxhQUFPLENBQUM1RSxNQUFNK0UsT0FBUCxJQUFrQnJGLFFBQVE2RSxJQUFSLEVBQWMsRUFBZCxDQUF6QjtBQUNEO0FBN0lJLEdBQVA7QUErSUQsQ0FoSmtELENBQW5EOztBQWtKQSIsImZpbGUiOiJuZy1zbGljay5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcbmltcG9ydCB7fSBmcm9tICdzbGljay1jYXJvdXNlbCc7XG5pbXBvcnQge30gZnJvbSAnc2xpY2stY2Fyb3VzZWwvc2xpY2svc2xpY2suY3NzJztcbmltcG9ydCB7fSBmcm9tICcuL25nLXNsaWNrLmxlc3MnO1xuLy9yZXF1aXJlKCdzbGljay1jYXJvdXNlbC9zbGljay9zbGljay10aGVtZS5jc3MnKTtcblxuYW5ndWxhci5tb2R1bGUoJ25nU2xpY2snLCBbXSkuZGlyZWN0aXZlKCduZ1NsaWNrJywgWyckdGltZW91dCcsIGZ1bmN0aW9uKHRpbWVvdXQpIHtcbiAgcmV0dXJuIHtcbiAgICBzY29wZToge1xuICAgICAgbmdTbGlja09wdGlvbnM6ICc9J1xuICAgIH0sXG4gICAgcmVzdHJpY3Q6ICdBRScsXG4gICAgbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIGxldCBsYXN0c2xpZGU7XG4gICAgICBjb25zdCBwYXJlbnQgPSBzY29wZS4kcGFyZW50O1xuXG4gICAgICBjb25zdCBzbGlkZXIgPSAkKGVsZW1lbnQpXG4gICAgICAgIC5hZGRDbGFzcygnbmctc2xpY2snKVxuICAgICAgICAuY3NzKCdvcGFjaXR5JywgMClcbiAgICAgICAgLm9uKCdpbml0JywgKGV2ZW50LCBzbGljaykgPT4ge1xuICAgICAgICAgIGNvbnN0IHNsaWRlID0gc2xpY2suJHNsaWRlc1tzbGljay5zbGlja0N1cnJlbnRTbGlkZSgpXTtcbiAgICAgICAgICBpZiggc2xpZGUgJiYgYXR0cnMuem9vbWluZyA9PT0gJ3RydWUnICkge1xuICAgICAgICAgICAgJChzbGlkZSkuYWRkQ2xhc3MoJ3NsaWNrLXNsaWRlLXpvb21pbmcnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiggYXR0cnMubmdTbGlja0luaXQgKVxuICAgICAgICAgICAgcGFyZW50LiRldmFsKGF0dHJzLm5nU2xpY2tJbml0LCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGlja30pO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ2JlZm9yZUNoYW5nZScsIChldmVudCwgc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKSA9PiB7XG4gICAgICAgICAgbGFzdHNsaWRlID0gc2xpY2suJHNsaWRlc1tjdXJyZW50U2xpZGVdO1xuXG4gICAgICAgICAgY29uc3Qgc2xpZGUgPSBzbGljay4kc2xpZGVzW25leHRTbGlkZV07XG4gICAgICAgICAgaWYoIHNsaWRlICYmIGF0dHJzLnpvb21pbmcgPT09ICd0cnVlJyApIHtcbiAgICAgICAgICAgICQoc2xpZGUpLmFkZENsYXNzKCdzbGljay1zbGlkZS16b29taW5nJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYoIGF0dHJzLm5nU2xpY2tCZWZvcmVDaGFuZ2UgKVxuICAgICAgICAgICAgcGFyZW50LiRldmFsKGF0dHJzLm5nU2xpY2tCZWZvcmVDaGFuZ2UsIHskZXZlbnQ6IGV2ZW50LCAkc2xpY2s6IHNsaWNrLCAkY3VycmVudFNsaWRlOiBjdXJyZW50U2xpZGUsICRuZXh0U2xpZGU6IG5leHRTbGlkZX0pO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ2FmdGVyQ2hhbmdlJywgKGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlKSA9PiB7XG4gICAgICAgICAgaWYoIGxhc3RzbGlkZSApICQobGFzdHNsaWRlKS5yZW1vdmVDbGFzcygnc2xpY2stc2xpZGUtem9vbWluZycpO1xuXG4gICAgICAgICAgaWYoIGF0dHJzLm5nU2xpY2tBZnRlckNoYW5nZSApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja0FmdGVyQ2hhbmdlLCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGljaywgJGN1cnJlbnRTbGlkZTogY3VycmVudFNsaWRlfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignYnJlYWtwb2ludCcsIChldmVudCwgc2xpY2ssIGJyZWFrcG9pbnQpID0+IHtcbiAgICAgICAgICBpZiggYXR0cnMubmdTbGlja0JyZWFrcG9pbnQgKVxuICAgICAgICAgICAgcGFyZW50LiRldmFsKGF0dHJzLm5nU2xpY2tCcmVha3BvaW50LCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGljaywgJGJyZWFrcG9pbnQ6IGJyZWFrcG9pbnR9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKCdkZXN0cm95JywgKGV2ZW50LCBzbGljaykgPT4ge1xuICAgICAgICAgIGlmKCBhdHRycy5uZ1NsaWNrRGVzdHJveSApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja0Rlc3Ryb3ksIHskZXZlbnQ6IGV2ZW50LCAkc2xpY2s6IHNsaWNrfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignZWRnZScsIChldmVudCwgc2xpY2ssIGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAgIGlmKCBhdHRycy5uZ1NsaWNrRWRnZSApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja0VkZ2UsIHskZXZlbnQ6IGV2ZW50LCAkc2xpY2s6IHNsaWNrLCAkZGlyZWN0aW9uOiBkaXJlY3Rpb259KTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKCdyZUluaXQnLCAoZXZlbnQsIHNsaWNrKSA9PiB7XG4gICAgICAgICAgaWYoIGF0dHJzLm5nU2xpY2tSZUluaXQgKVxuICAgICAgICAgICAgcGFyZW50LiRldmFsKGF0dHJzLm5nU2xpY2tSZUluaXQsIHskZXZlbnQ6IGV2ZW50LCAkc2xpY2s6IHNsaWNrfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignc2V0UG9zaXRpb24nLCAoZXZlbnQsIHNsaWNrKSA9PiB7XG4gICAgICAgICAgaWYoIGF0dHJzLm5nU2xpY2tTZXRQb3NpdGlvbiApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja1NldFBvc2l0aW9uLCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGlja30pO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ3N3aXBlJywgKGV2ZW50LCBzbGljaywgZGlyZWN0aW9uKSA9PiB7XG4gICAgICAgICAgaWYoIGF0dHJzLm5nU2xpY2tTd2lwZSApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja1N3aXBlLCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGljaywgJGRpcmVjdGlvbjogZGlyZWN0aW9ufSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignbGF6eUxvYWRlZCcsIChldmVudCwgc2xpY2ssIGltYWdlLCBpbWFnZVNvdXJjZSkgPT4ge1xuICAgICAgICAgIGlmKCBhdHRycy5uZ1NsaWNrTGF6eUxvYWRlZCApXG4gICAgICAgICAgICBwYXJlbnQuJGV2YWwoYXR0cnMubmdTbGlja0xhenlMb2FkZWQsIHskZXZlbnQ6IGV2ZW50LCAkc2xpY2s6IHNsaWNrLCAkaW1hZ2U6IGltYWdlLCAkc3JjOiBpbWFnZVNvdXJjZSwgJGltYWdlU291cmNlOiBpbWFnZVNvdXJjZX0pO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ2xhenlMb2FkRXJyb3InLCAoZXZlbnQsIHNsaWNrLCBpbWFnZSwgaW1hZ2VTb3VyY2UpID0+IHtcbiAgICAgICAgICBpZiggYXR0cnMubmdTbGlja0xhenlMb2FkRXJyb3IgKVxuICAgICAgICAgICAgcGFyZW50LiRldmFsKGF0dHJzLm5nU2xpY2tMYXp5TG9hZEVycm9yLCB7JGV2ZW50OiBldmVudCwgJHNsaWNrOiBzbGljaywgJGltYWdlOiBpbWFnZSwgJHNyYzogaW1hZ2VTb3VyY2UsICRpbWFnZVNvdXJjZTogaW1hZ2VTb3VyY2V9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJ1aWxkb3B0aW9ucyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgbyA9IHNjb3BlLm5nU2xpY2tPcHRpb25zIHx8IHt9O1xuXG4gICAgICAgIGlmKCAnZG90cycgaW4gYXR0cnMgKSBvLmRvdHMgPSBhdHRycy5kb3RzICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ2Nzc0Vhc2UnIGluIGF0dHJzICkgby5jc3NFYXNlID0gYXR0cnMuY3NzRWFzZTtcbiAgICAgICAgaWYoICdmYWRlJyBpbiBhdHRycyApIG8uZmFkZSA9IGF0dHJzLmZhZGUgPT09ICd0cnVlJztcbiAgICAgICAgaWYoICdmb2N1c09uU2VsZWN0JyBpbiBhdHRycyApIG8uZm9jdXNPblNlbGVjdCA9IGF0dHJzLmZvY3VzT25TZWxlY3Q7XG4gICAgICAgIGlmKCAnbGF6eUxvYWQnIGluIGF0dHJzICkgby5sYXp5TG9hZCA9IGF0dHJzLmxhenlMb2FkID09PSAndHJ1ZSc7XG4gICAgICAgIGlmKCAnZHJhZ2dhYmxlJyBpbiBhdHRycyApIG8uZHJhZ2dhYmxlID0gYXR0cnMuZHJhZ2dhYmxlICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ2Vhc2luZycgaW4gYXR0cnMgKSBvLmVhc2luZyA9IGF0dHJzLmVhc2luZztcbiAgICAgICAgaWYoICdjZW50ZXJNb2RlJyBpbiBhdHRycyApIG8uY2VudGVyTW9kZSA9IGF0dHJzLmNlbnRlck1vZGU7XG4gICAgICAgIGlmKCAnY2VudGVyUGFkZGluZycgaW4gYXR0cnMgKSBvLmNlbnRlclBhZGRpbmcgPSBhdHRycy5jZW50ZXJQYWRkaW5nO1xuICAgICAgICBpZiggJ2FjY2Vzc2liaWxpdHknIGluIGF0dHJzICkgby5hY2Nlc3NpYmlsaXR5ID0gYXR0cnMuYWNjZXNzaWJpbGl0eSAhPT0gJ2ZhbHNlJztcbiAgICAgICAgaWYoICdjZW50ZXJQYWRkaW5nJyBpbiBhdHRycyApIG8uY2VudGVyUGFkZGluZyA9IGF0dHJzLmNlbnRlclBhZGRpbmc7XG4gICAgICAgIGlmKCAnYWRhcHRpdmVIZWlnaHQnIGluIGF0dHJzICkgby5hZGFwdGl2ZUhlaWdodCA9IGF0dHJzLmFkYXB0aXZlSGVpZ2h0ICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ2Fycm93cycgaW4gYXR0cnMgKSBvLmFycm93cyA9IGF0dHJzLmFycm93cyAhPT0gJ2ZhbHNlJztcbiAgICAgICAgaWYoICdwYXVzZU9uSG92ZXInIGluIGF0dHJzICkgby5wYXVzZU9uSG92ZXIgPSBhdHRycy5wYXVzZU9uSG92ZXIgIT09ICdmYWxzZSc7XG4gICAgICAgIGlmKCAncmVzcG9uc2l2ZScgaW4gYXR0cnMgKSBvLnJlc3BvbnNpdmUgPSBhdHRycy5yZXNwb25zaXZlICYmIHBhcmVudC4kZXZhbChhdHRycy5yZXNwb25zaXZlKTtcbiAgICAgICAgaWYoICdydGwnIGluIGF0dHJzICkgby5ydGwgPSBhdHRycy5ydGwgPT09ICd0cnVlJztcbiAgICAgICAgaWYoICd0b3VjaE1vdmUnIGluIGF0dHJzICkgby50b3VjaE1vdmUgPSBhdHRycy50b3VjaE1vdmUgIT09ICdmYWxzZSc7XG4gICAgICAgIGlmKCAndG91Y2hUaHJlc2hvbGQnIGluIGF0dHJzICYmICthdHRycy50b3VjaFRocmVzaG9sZCApIG8udG91Y2hUaHJlc2hvbGQgPSArYXR0cnMudG91Y2hUaHJlc2hvbGQ7XG4gICAgICAgIGlmKCAndXNlQ1NTJyBpbiBhdHRycyApIG8udXNlQ1NTID0gYXR0cnMudXNlQ1NTICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ3ZhcmlhYmxlV2lkdGgnIGluIGF0dHJzICkgby52YXJpYWJsZVdpZHRoID0gYXR0cnMudmFyaWFibGVXaWR0aCAhPT0gJ2ZhbHNlJztcbiAgICAgICAgaWYoICd2ZXJ0aWNhbCcgaW4gYXR0cnMgKSBvLnZlcnRpY2FsID0gYXR0cnMudmVydGljYWwgIT09ICdmYWxzZSc7XG4gICAgICAgIGlmKCAnaW5maW5pdGUnIGluIGF0dHJzICkgby5pbmZpbml0ZSA9IGF0dHJzLmluZmluaXRlICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ3NwZWVkJyBpbiBhdHRycyAmJiArYXR0cnMuc3BlZWQgKSBvLnNwZWVkID0gK2F0dHJzLnNwZWVkO1xuICAgICAgICBpZiggJ3NsaWRlc1RvU2hvdycgaW4gYXR0cnMgJiYgK2F0dHJzLnNsaWRlc1RvU2hvdyApIG8uc2xpZGVzVG9TaG93ID0gK2F0dHJzLnNsaWRlc1RvU2hvdztcbiAgICAgICAgaWYoICdzd2lwZVRvU2xpZGUnIGluIGF0dHJzICkgby5zd2lwZVRvU2xpZGUgPSBhdHRycy5zd2lwZVRvU2xpZGUgIT09ICdmYWxzZSc7XG4gICAgICAgIGlmKCAnYXV0b3BsYXknIGluIGF0dHJzICkgby5hdXRvcGxheSA9IGF0dHJzLmF1dG9wbGF5ICE9PSAnZmFsc2UnO1xuICAgICAgICBpZiggJ2F1dG9wbGF5U3BlZWQnIGluIGF0dHJzICYmICthdHRycy5hdXRvcGxheVNwZWVkICkgby5hdXRvcGxheVNwZWVkID0gK2F0dHJzLmF1dG9wbGF5U3BlZWQ7XG4gICAgICAgIGlmKCAnekluZGV4JyBpbiBhdHRycyAmJiArYXR0cnMuekluZGV4ICkgby56SW5kZXggPSArYXR0cnMuekluZGV4O1xuXG4gICAgICAgIHJldHVybiBvO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICAgICAgaWYoICFzbGlkZXIuaGFzQ2xhc3MoJ25nLXNsaWNrLWluaXQnKSApIHtcbiAgICAgICAgICBzbGlkZXIuYWRkQ2xhc3MoJ25nLXNsaWNrLWluaXQnKS5jc3MoJ29wYWNpdHknLCAxKS5zbGljayhidWlsZG9wdGlvbnMoKSkuc2xpY2soJ3NldFBvc2l0aW9uJykuc2xpY2soJ3NsaWNrR29UbycsIDApLnNsaWNrKCdzbGlja1BsYXknKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgZGVzdHJveSA9ICgpID0+IHtcbiAgICAgICAgaWYoIHNsaWRlci5oYXNDbGFzcygnbmctc2xpY2staW5pdCcpIClcbiAgICAgICAgICBzbGlkZXIucmVtb3ZlQ2xhc3MoJ25nLXNsaWNrLWluaXQnKS5yZW1vdmUoJ3NsaWNrLWxpc3QnKS5zbGljaygndW5zbGljaycpO1xuICAgICAgfTtcblxuICAgICAgbGV0IHJlZnJlc2hpbmcgPSBmYWxzZTtcbiAgICAgIGNvbnN0IHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgICAgIGlmKCByZWZyZXNoaW5nICkgcmV0dXJuO1xuXG4gICAgICAgIHJlZnJlc2hpbmcgPSB0cnVlO1xuICAgICAgICBkZXN0cm95KCk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHJlZnJlc2hpbmcgPSBmYWxzZTtcbiAgICAgICAgICBpbml0KCk7XG4gICAgICAgIH0sIDE1MCk7XG4gICAgICB9O1xuXG4gICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgKCkgPT4gZGVzdHJveSgpKTtcblxuICAgICAgYXR0cnMubmdXYXRjaCAmJiBwYXJlbnQuJHdhdGNoKGF0dHJzLm5nV2F0Y2gsICgpID0+IHRpbWVvdXQocmVmcmVzaCkpO1xuXG4gICAgICBzY29wZS4kd2F0Y2goJ25nU2xpY2tPcHRpb25zJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBvID0gc2NvcGUubmdTbGlja09wdGlvbnM7XG4gICAgICAgIGlmKCBvICYmIHR5cGVvZiBvID09PSAnb2JqZWN0JyApIHRpbWVvdXQocmVmcmVzaCk7XG4gICAgICB9LCB0cnVlKTtcblxuICAgICAgc2NvcGUucmVmcmVzaCA9IGVsZW1lbnRbMF0ucmVmcmVzaCA9ICgpID0+IHRpbWVvdXQocmVmcmVzaCk7XG5cbiAgICAgIHJldHVybiAhYXR0cnMubmdXYXRjaCAmJiB0aW1lb3V0KGluaXQsIDEwKTtcbiAgICB9XG4gIH07XG59XSk7XG5cbi8vIHJlZjogaHR0cDovL3BsbmtyLmNvL2VkaXQvV0NFV3dnTmNJRUMwcnNlYVpJTzY/cD1wcmV2aWV3XG4iXX0=